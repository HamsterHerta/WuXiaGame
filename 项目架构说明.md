# 项目架构说明（开源前端武侠模板）

## 1. 项目定位
本项目是一个“前端武侠抉择游戏模板”，核心目标是：
- 用数据驱动故事与规则
- 通过事件表快速扩写剧情
- 可作为开源模板供二次开发

## 2. 核心架构

### 2.1 分层结构
- 数据层（`src/data`）
  事件、结局、地点、文案、类型定义。
- 逻辑层（`src/store/gameStore.ts`）
  事件选择、条件判定、时间推进、存档与结局判定。
- 视图层（`src/views`、`src/components`）
  页面与组件渲染，逻辑尽量薄。

### 2.2 事件驱动
事件由 `events.ts` 统一管理，逻辑层根据“时间/地点/条件/随机概率”决定下一个事件。

事件分类：
- `fixed` 固定事件：到指定日期必触发
- `conditional` 条件事件：条件满足必触发
- `random` 随机事件：条件满足后按概率触发

## 3. 关键类型（`src/data/types.ts`）

- `Event`：事件主体
- `Option`：选项与效果
- `Condition`：触发条件
- `GameState`：游戏运行态
- `RelationEffect`：目标人物/势力关系变化

## 4. 时间系统
- 日期结构：`{ year, month, day }`
- 逻辑位于 `gameStore.ts`
- `MAX_DAYS` 控制总时长
- 事件持续时间：`durationDays` 或 `waitDays`

时间推进优先级：
1. `option.durationDays`
2. `option.waitDays`
3. `event.durationDays`
4. `event.waitDays`
5. 默认 `1`

## 5. 地点系统
- 地点表：`src/data/locations.ts`
- 事件地点约束：`event.locationId`
- 选项移动：`option.moveTo`

新增地点步骤：
1. `types.ts` 添加 `LocationId`
2. `locations.ts` 添加条目
3. `i18n.ts` 添加文案

## 6. 人物关系系统
关系按目标人物/势力保存：
```
relations: Record<targetId, { favor, rivalry, loyalty }>
```

相关写法：
```ts
relationTarget: 'li_qing',
relationEffects: [{ stat: 'favor', delta: 2, target: 'li_qing' }]
```

条件判定：
```ts
{ type: 'relMin', stat: 'favor', value: 3, target: 'li_qing' }
```

## 7. 事件模板与触发顺序

### 事件模板
```ts
{
  id: 'event_new',
  titleKey: 'event.new.title',
  descKey: 'event.new.desc',
  category: 'conditional',
  locationId: 'tavern',
  durationDays: 2,
  conditions: [{ type: 'statMin', stat: 'wisdom', value: 3 }],
  options: [
    {
      textKey: 'event.new.opt1',
      effects: [{ stat: 'wisdom', delta: 1 }],
      relationTarget: 'li_qing',
      relationEffects: [{ stat: 'favor', delta: 1 }],
      moveTo: 'market'
    }
  ]
}
```

### 事件触发顺序
1. 到期 `fixed`
2. 满足条件的 `conditional`
3. 满足条件的 `random`（按概率）
4. 无事件则回 `START_EVENT_ID`

## 8. 文件职责列表

- `src/data/types.ts` 类型声明
- `src/data/events.ts` 事件数据表
- `src/data/endings.ts` 结局数据表
- `src/data/locations.ts` 地点表
- `src/data/i18n.ts` 文案表
- `src/store/gameStore.ts` 核心逻辑
- `src/views/StartScreen.vue` 开始页
- `src/views/GameScreen.vue` 游戏主界面
- `src/views/EndScreen.vue` 结局页
- `src/components/*` 复用组件

## 9. 如何扩展

新增事件：
1. 在 `events.ts` 新增事件对象
2. 在 `i18n.ts` 补齐 `title/desc/opt` 文案

新增人物/势力：
1. 直接在事件中使用目标 ID
2. 关系变化与条件判定写 `relationTarget/relMin/relMax`

新增地点：
1. 更新 `LocationId`
2. 更新 `locations.ts`
3. 更新 `i18n.ts`

调整时间：
1. 调整 `MAX_DAYS`
2. 修改事件 `durationDays` 或选项 `durationDays`

## 10. 构建与发布

构建：
```bash
npm run build
```

产物在 `dist/`，可直接部署至任意静态托管。

## 11. 清理与规范
建议 `.gitignore` 中包含：
```
node_modules
/dist
*.tsbuildinfo
.DS_Store
vite.config.js
vite.config.d.ts
```

如仓库已有这些生成文件，应删除后再提交。
